<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Route Finder</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
body, html { height: 100%; margin: 0; font-family: "Poppins", sans-serif; background-color: #f5f5f5; color: #000; }
#map { height: 100vh; width: 100%; position: absolute; top:0; left:0; z-index:1; }
.form-box {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.95);
    padding: 30px 40px; border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    z-index: 10; backdrop-filter: blur(10px);
}
.form-box input { margin-bottom: 15px; background: #fff; border: 1px solid #ccc; color: #000; }
.form-box button { width: 100%; background: #007bff; color: #fff; border: none; padding: 10px; font-weight: 600; border-radius: 8px; transition: 0.3s; }
.form-box button:hover { background: #0056b3; }
.brand { text-align:center; color:#007bff; font-weight:600; margin-bottom:10px; }
.error { color:#ff4c4c; margin-top:10px; text-align:center; }
</style>
</head>
<body>

<div id="map">
    <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=68.1,6.5,97.4,37.1&layer=mapnik" width="100%" height="100%" style="border:none;"></iframe>
</div>

<div class="form-box">
    <div class="brand">
        <h3>üó∫Ô∏è Route Finder</h3>
        <p style="font-size:14px; color:#666;">Find shortest routes instantly</p>
    </div>

    <form method="POST" id="routeForm">
        <div class="form-group">
            <input type="text" id="start_input" name="start" class="form-control" placeholder="üö© Starting Place" required readonly>
        </div>
        <div class="form-group">
            <input type="text" name="end" class="form-control" placeholder="üèÅ Destination" required>
        </div>

        <input type="hidden" name="start_lat" id="start_lat">
        <input type="hidden" name="start_lon" id="start_lon">

        <button type="submit" class="btn mt-2">Find Route</button>
    </form>

    <a href="/connect_spotify" class="btn btn-success w-100 mt-3">üé∂ Connect Spotify</a>

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}
</div>

<script>
document.getElementById("start_input").addEventListener("click", function() {
    const useCurrent = confirm("Click OK to use your Current Location, or Cancel to enter manually.");
    if (useCurrent) {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position){
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                document.getElementById('start_lat').value = lat;
                document.getElementById('start_lon').value = lon;
                document.getElementById('start_input').value = "Current Location";
                document.getElementById('start_input').setAttribute("readonly", true);
            }, function(error){
                alert("Could not get your location. Make sure location services are enabled.");
                document.getElementById('start_input').removeAttribute("readonly");
            });
        } else {
            alert("Geolocation is not supported by your browser.");
            document.getElementById('start_input').removeAttribute("readonly");
        }
    } else {
        document.getElementById('start_input').value = "";
        document.getElementById('start_input').removeAttribute("readonly");
    }
});
</script>

</body>
</html>
